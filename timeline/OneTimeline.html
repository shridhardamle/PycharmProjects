<html>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAOawiASNbqQ4TWXRS-pBpQdJHjizGfhyY"></script>
<script language="javascript" type="text/javascript" src="jquery.js"></script>
<p id="output"></p>
<script id="source" language="javascript" type="text/javascript">
    function setRoutes(){
        
        var directionsDisplay = new Array();
        
        for (var i=0; i< startLoc.length; i++){
            
            var rendererOptions = {
                map: map,
                suppressMarkers : true,
                preserveViewport: true
            }
            directionsService = new google.maps.DirectionsService();
            
            var travelMode = google.maps.DirectionsTravelMode.DRIVING;
            
            var request = {
                origin: startLoc[i],
                destination: endLoc[i],
                travelMode: travelMode
            };  
            
            directionsService.route(request,makeRouteCallback(i,directionsDisplay[i]));
            
        }
        function makeRouteCallback(routeNum,disp){
            if (polyline[routeNum] && (polyline[routeNum].getMap() != null)) {
                startAnimation(routeNum);
                return;
            }
            return function(response, status){
                
                if (status == google.maps.DirectionsStatus.OK){
                    
                    var bounds = new google.maps.LatLngBounds();
                    var route = response.routes[0];
                    startLocation[routeNum] = new Object();
                    endLocation[routeNum] = new Object();
                    
                    
                    polyline[routeNum] = new google.maps.Polyline({
                                                                  path: [],
                                                                  strokeColor: '#FFFF00',
                                                                  strokeWeight: 3
                                                                  });
                                                                  
                                                                  poly2[routeNum] = new google.maps.Polyline({
                                                                                                             path: [],
                                                                                                             strokeColor: '#FFFF00',
                                                                                                             strokeWeight: 3
                                                                                                             });
                                                                                                             
                                                                                                             
                                                                                                             // For each route, display summary information.
                                                                                                             var path = response.routes[0].overview_path;
                                                                                                             var legs = response.routes[0].legs;
                                                                                                             
                                                                                                             
                                                                                                             disp = new google.maps.DirectionsRenderer(rendererOptions);     
                                                                                                             disp.setMap(map);
                                                                                                             disp.setDirections(response);
                                                                                                             
                                                                                                             
                                                                                                             //Markers               
                                                                                                             for (i=0;i<legs.length;i++) {
                                                                                                                 if (i == 0) { 
                                                                                                                     startLocation[routeNum].latlng = legs[i].start_location;
                                                                                                                     startLocation[routeNum].address = legs[i].start_address;
                                                                                                                     // marker = google.maps.Marker({map:map,position: startLocation.latlng});
                                                                                                                     marker[routeNum] = createMarker(legs[i].start_location,"start",legs[i].start_address,"green");
                                                                                                                 }
                                                                                                                 endLocation[routeNum].latlng = legs[i].end_location;
                                                                                                                 endLocation[routeNum].address = legs[i].end_address;
                                                                                                                 var steps = legs[i].steps;
                                                                                                                 
                                                                                                                 for (j=0;j<steps.length;j++) {
                                                                                                                     var nextSegment = steps[j].path;                
                                                                                                                     var nextSegment = steps[j].path;
                                                                                                                     
                                                                                                                     for (k=0;k<nextSegment.length;k++) {
                                                                                                                         polyline[routeNum].getPath().push(nextSegment[k]);
                                                                                                                         //bounds.extend(nextSegment[k]);
                                                                                                                     }
                                                                                                                     
                                                                                                                 }
                                                                                                             }
                                                                                                             
                }       
                
                polyline[routeNum].setMap(map);
                //map.fitBounds(bounds);
                startAnimation(routeNum);  
                
            } // else alert("Directions request failed: "+status);
            
        }
        
    }
function startAnimation(index) {
    if (timerHandle[index]) clearTimeout(timerHandle[index]);
    eol[index]=polyline[index].Distance();
    map.setCenter(polyline[index].getPath().getAt(0));
    
    poly2[index] = new google.maps.Polyline({path: [polyline[index].getPath().getAt(0)], strokeColor:"#FFFF00", strokeWeight:3});
    
    timerHandle[index] = setTimeout("animate("+index+",50)",2000);  // Allow time for the initial map display
}
</script>
<table>
<tr>
    <td>
        <div id="dvMap" style="width: 1000px; height: 600px">
        </div>
    </td>


    <button type="button" id="simulateRouteButton">Click Me!</button>
</tr>
</table>

</html>
